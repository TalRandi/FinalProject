<div id="loading" *ngIf="isLoading">
    <app-loading-spinner></app-loading-spinner>
</div>

<div class="container-fluid" *ngIf="!isLoading">
    <div class="row">
        <div class="col-12 col-md-2">
            <app-control-panel></app-control-panel>            
        </div>

        <div class="col-11 col-md-7 zimmer-list">
            <ng-template [ngIf]="zimmers_to_display.length > 0" [ngIfElse]="Empty">
                <div class="row">
                    <div class="col-4 col-auto ml-auto title">
                        <h1 class="result-title">({{ zimmers_to_display.length }} תוצאות)</h1>
                    </div>
                    <button class="btn sort-btn" *ngIf="!sort_direction" (click)="sortDirection()"><mat-icon>arrow_downward</mat-icon></button>
                    <button class="btn sort-btn" *ngIf="sort_direction" (click)="sortDirection()"><mat-icon>arrow_upward</mat-icon></button>
                    <div class="sort-elements">
                        <mat-form-field dir='rtl' appearance="fill">
                          <mat-label>מיין לפי</mat-label>
                          <mat-select (selectionChange)="sortBy($event.value)" [value]="sort_parameter">
                            <mat-option *ngFor="let sort of sorts" [value]="sort.value">
                              {{sort.viewValue}}
                            </mat-option>
                          </mat-select>
                        </mat-form-field>
                    </div>
                </div>
                <div class="row" *ngIf="region_filter.length != 0 || general_filter.length != 0 || zimmer_to_search">
                    <h3 class="active-filter-title">סינונים פעילים:</h3>
                </div>
                <div class="row">
                    <div class="col-4 col-md-2 active-filter" *ngFor="let region of region_filter">
                        {{region}}
                    </div>
                    <div class="col-4 col-md-2 active-filter" *ngFor="let filter of general_filter">
                        {{getByValue(dictionary, filter)}}
                    </div>
                    <div class="col-4 col-md-2 active-filter" *ngIf="zimmer_to_search">
                        {{zimmer_to_search}}
                    </div>
                </div>
                <div class="row justify-content-start hut-details" *ngFor="let zimmer of zimmers_to_display; let index = index">
                    <div class="col-12 col-md-4">
                        <ngb-carousel [showNavigationIndicators]="false">
                            <ng-template ngbSlide *ngFor="let image of zimmers_to_display[index].images; let image_index = index">
                              <div>
                                <img [src]="image | getDownloadURL" height="300px" width="100%">
                              </div>
                              <div class="carousel-caption">
                                    {{ zimmers_to_display[index].images.length }} / {{ image_index+1 }}
                              </div>
                            </ng-template>
                        </ngb-carousel>
                    </div>
                    <div class="col-6 col-md-3 description_and_features" (click)="zimmer_clicked(zimmer)">
                        <h1>{{ zimmer.zimmerName }}<h4><mat-icon> location_on</mat-icon> {{ zimmer.region }}, {{ zimmer.address.formatted_address.includes(", ישראל")? zimmer.address.formatted_address.substring(0, zimmer.address.formatted_address.length - 7) : zimmer.address.formatted_address }}</h4></h1>
                        <h4 class="description">{{ (zimmer.generalDescription.length>80)? (zimmer.generalDescription | slice:0:80)+'...':(zimmer.generalDescription) }}<h5 *ngIf="zimmer.generalDescription.length > 130"><b>לחץ להמשך קריאה ופרטים נוספים</b></h5></h4>
                        <div class="row" *ngIf="zimmer.features != undefined">
                            <div class="col-6" *ngIf="zimmer.features.includes('jacuzzi')">
                                <h6><mat-icon>hot_tub</mat-icon> ג'קוזי</h6>
                            </div>
                            <div class="col-6" *ngIf="zimmer.features.includes('pool')">
                                <h6><mat-icon>pool</mat-icon> בריכה</h6>
                            </div>
                            <div class="col-6" *ngIf="zimmer.features.includes('heated_pool')">
                                <h6><mat-icon>pool</mat-icon> בריכה מחוממת</h6>
                            </div>
                            <div class="col-6" *ngIf="zimmer.features.includes('indoor_pool')">
                                <h6><mat-icon>pool</mat-icon> בריכה מקורה</h6>
                            </div>
                            <div class="col-6" *ngIf="zimmer.features.includes('air_conditioner')">
                                <h6><mat-icon>wb_sunny</mat-icon> מזגן</h6>
                            </div>
                            <div class="col-6" *ngIf="zimmer.features.includes('wifi')">
                                <h6><mat-icon>wifi</mat-icon> wifi</h6>
                            </div>
                            <div class="col-6" *ngIf="zimmer.features.includes('sauna')">
                                <h6><mat-icon>spa</mat-icon> סאונה</h6>
                            </div>
                            <div class="col-6" *ngIf="zimmer.features.includes('parking')">
                                <h6><mat-icon> local_parking</mat-icon> חניה</h6>
                            </div>
                        </div>
                    </div>
                    <div class="col-6 col-md-4 prices_and_details" (click)="zimmer_clicked(zimmer)">
                        <h2>{{ zimmer.ownerName }} - {{ zimmer.phone }}</h2>
                        <h4>מקסימום אורחים: {{ zimmer.total_capacity }}</h4>
                        <h4>מספר בקתות: {{ zimmer.huts.length }}</h4>
                        <h4>דירוג הגולשים: <ngb-rating [rate]="zimmer.rate | round" [readonly]="true" [max]="5"></ngb-rating></h4>
                        <div class="price row">
                            <div class="col-6">
                                <h2>אמצ"ש החל מ {{ zimmer.min_price_regular }} ש"ח</h2>
                            </div>
                            <div class="col-6">
                                <h2>סופ"ש החל מ {{ zimmer.min_price_weekend }} ש"ח</h2>
                            </div>
                        </div>
                    </div>
                    <div class="col-12 col-md-1 block_and_book">  
                        <mat-icon *ngIf="client && !isFavorite(zimmer.zimmer_id)" (click)="favoriteClicked(zimmer, 'addFavorite')" class="favorite">favorite_border</mat-icon>
                        <mat-icon *ngIf="client && isFavorite(zimmer.zimmer_id)" (click)="favoriteClicked(zimmer, 'removeFavorite')" class="favorite">favorite</mat-icon>
                        <button (click)="zimmer_clicked(zimmer)" class="btn btn-block order-here">הזמן כאן</button>
                        <button *ngIf="this.authService.admin" (click)="disableZimmer(zimmer, index)" class="btn btn-block block-zimmer">חסימה</button>
                    </div>
                </div>
            </ng-template>
            <ng-template #Empty>
                <div class="row justify-content-center">
                    <h1>אין פריטים להצגה</h1>
                </div>
            </ng-template>
        </div>
    </div>
</div>